<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Catalogue</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<body class="font-sans p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Featured Books</h1>
        
        <table class="w-full">
            <tbody id="catalogue-body">
                <!-- Random books will be loaded here -->
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const catalogueBody = document.getElementById('catalogue-body');
            const catalogueFiles = [
                'Left-Frame/cse-catalogue.html',
                'Left-Frame/ece-catalogue.html',
                'Left-Frame/eee-catalogue.html',
                'Left-Frame/civil-catalogue.html'
            ];

            let allBooks = [];

            try {
                const responses = await Promise.all(catalogueFiles.map(file => fetch(file)));
                const htmlStrings = await Promise.all(responses.map(res => res.text()));

                htmlStrings.forEach(htmlString => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlString, 'text/html');
                    const rows = doc.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const title = row.querySelector('h2').innerText;
                        const price = row.querySelector('.text-xl.font-bold').innerText;
                        const previewLink = row.querySelector('a').href;
                        allBooks.push({ title, price, previewLink });
                    });
                });

                // Shuffle and pick a few books
                const shuffledBooks = allBooks.sort(() => 0.5 - Math.random());
                const selectedBooks = shuffledBooks.slice(0, 8); // Show 8 random books

                selectedBooks.forEach(book => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-300';
                    row.innerHTML = `
                        <td class="p-4 align-top">
                            <h2 class="text-xl font-semibold text-gray-900 mb-2">${book.title}</h2>
                        </td>
                        <td class="p-4 align-top w-28">
                            <p class="text-xl font-bold text-gray-800">${book.price}</p>
                        </td>
                        <td class="p-4 align-top w-40">
                            <a href="${book.previewLink}" target="_blank" class="inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white font-medium rounded-md shadow-sm hover:bg-blue-700">
                                Preview
                            </a>
                        </td>
                        <td class="p-4 align-top w-40">
                            <button class="add-to-cart-btn inline-flex items-center justify-center px-4 py-2 bg-indigo-600 text-white font-medium rounded-md shadow-sm hover:bg-indigo-700">
                                Add to Cart
                            </button>
                        </td>
                    `;
                    catalogueBody.appendChild(row);
                });

                // Add to cart functionality
                const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
                addToCartButtons.forEach(button => {
                    button.addEventListener('click', (event) => {
                        const row = button.closest('tr');
                        const title = row.querySelector('h2').innerText;
                        const price = row.querySelector('.text-xl.font-bold').innerText;
                        
                        const book = {
                            title,
                            price,
                            image: 'https://placehold.co/600x400/5e81ac/white?text=Book' // Placeholder image
                        };

                        let cart = JSON.parse(localStorage.getItem('cart')) || [];
                        cart.push(book);
                        localStorage.setItem('cart', JSON.stringify(cart));

                        alert(title + ' has been added to your cart.');
                    });
                });

            } catch (error) {
                console.error('Error loading book catalogues:', error);
                catalogueBody.innerHTML = '<tr><td class="p-4 text-red-500">Error loading books. Please try again later.</td></tr>';
            }
        });
    </script>

</body>
</html>